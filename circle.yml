machine:
  xcode:
    version: 8.3.3

checkout:
  post:
    # workaround for known git bug where attempting to fetch a missing commit fails early on the first try
    - git config --global url."git://".insteadOf https://
    - git submodule update --init --recursive || true
    - git submodule sync --recursive
    - git submodule deinit -f . && rm -rf .git/modules
    - git submodule update --init --recursive --force
    - make distclean

dependencies:
  pre:
    - ./Tools/setup/OSX.sh

test:
  override:
    #- NO_NINJA_BUILD=1 make -j2 quick_check
    - make posix_sitl_default
    - make px4fmu-v4pro_default
    - make tests
